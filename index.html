<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Calculator</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
                font-family: system-ui, sans-serif;
            }

            body {
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #10131a;
                color: #e0e6f0;
            }

            /* Bigger size */
            .calc-wrapper {
                background: #1a1f29;
                padding: 30px;
                border-radius: 22px;
                width: 380px;
                box-shadow: 0 0 35px rgba(0, 0, 0, 0.55);
            }

            .calc-header {
                margin-bottom: 15px;
            }

            .calc-title {
                font-size: 20px;
                font-weight: 700;
                letter-spacing: 0.04em;
                color: #8fa3c6;
            }

            .display {
                background: #0e1218;
                border-radius: 16px;
                padding: 20px;
                margin-bottom: 18px;
                box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.6);
            }

            .display-expression {
                min-height: 22px;
                font-size: 15px;
                color: #6d7a8f;
                text-align: right;
                word-wrap: break-word;
            }

            .display-value {
                margin-top: 6px;
                font-size: 40px;
                font-weight: 600;
                text-align: right;
                color: #ffffff;
            }

            .grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 12px;
            }

            button {
                border: none;
                padding: 20px 0;
                font-size: 20px;
                border-radius: 14px;
                cursor: pointer;
                background: #222833;
                color: #e5e9ef;
                transition: 0.08s ease;
                box-shadow: 0 4px 0 #151920;
            }

            button:active {
                transform: translateY(2px);
                box-shadow: 0 2px 0 #151920;
            }

            .btn-operator {
                background: #2f3a52;
                color: #65b4ff;
            }

            .btn-ac {
                background: #4b2b2b;
                color: #ffb3b3;
            }

            .btn-func {
                background: #2a2f3a;
                color: #9eb7d6;
            }

            .btn-equals {
                background: #1f5eff;
                color: white;
                grid-column: span 2;
            }

            .btn-zero {
                grid-column: span 2;
            }

            .history {
                margin-top: 18px;
                border-top: 1px solid #2b3240;
                padding-top: 10px;
                max-height: 120px;
                overflow-y: auto;
                font-size: 13px;
                color: #9aa8c0;
            }

            .history-header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 5px;
            }

            .history-item {
                padding: 4px 0;
                display: flex;
                justify-content: space-between;
                cursor: pointer;
            }

            .history-item:hover {
                color: #dce3f1;
            }

            .history-clear {
                background: none;
                color: #8091a9;
                border: none;
                font-size: 12px;
                cursor: pointer;
            }
        </style>
    </head>

    <body>
        <div class="calc-wrapper" id="calculator">
            <div class="calc-header">
                <div class="calc-title">CALCULATOR</div>
            </div>

            <div class="display">
                <div class="display-expression" id="expression"></div>
                <div class="display-value" id="result">0</div>
            </div>

            <div class="grid">
                <button class="btn-ac" data-action="clear">AC</button>
                <button class="btn-func" data-action="backspace">⌫</button>
                <button class="btn-func" data-value="%">%</button>
                <button class="btn-operator" data-value="/">÷</button>

                <button data-value="7">7</button>
                <button data-value="8">8</button>
                <button data-value="9">9</button>
                <button class="btn-operator" data-value="*">×</button>

                <button data-value="4">4</button>
                <button data-value="5">5</button>
                <button data-value="6">6</button>
                <button class="btn-operator" data-value="-">−</button>

                <button data-value="1">1</button>
                <button data-value="2">2</button>
                <button data-value="3">3</button>
                <button class="btn-operator" data-value="+">+</button>

                <button class="btn-zero" data-value="0">0</button>
                <button data-value=".">.</button>
                <button class="btn-equals" data-action="equals">=</button>
            </div>

            <div class="history" id="history">
                <div class="history-header">
                    <span>History</span>
                    <button class="history-clear" id="clearHistory">
                        Clear
                    </button>
                </div>
                <ul id="historyList">
                    <li class="history-empty">No calculations yet</li>
                </ul>
            </div>
        </div>

        <script>
            ;(function () {
                const expressionEl = document.getElementById('expression')
                const resultEl = document.getElementById('result')
                const historyList = document.getElementById('historyList')
                const clearHistoryBtn = document.getElementById('clearHistory')
                const calc = document.getElementById('calculator')

                let expression = ''
                let justEvaluated = false
                const history = []

                function updateDisplay() {
                    expressionEl.textContent = expression
                    resultEl.textContent = expression
                        ? resultEl.textContent
                        : '0'
                }

                function appendValue(v) {
                    if (justEvaluated && /[0-9.]/.test(v)) expression = ''
                    justEvaluated = false

                    const last = expression.slice(-1)
                    if ('+-*/%'.includes(last) && '+-*/%'.includes(v))
                        expression = expression.slice(0, -1) + v
                    else expression += v

                    updateDisplay()
                }

                function clearAll() {
                    expression = ''
                    justEvaluated = false
                    updateDisplay()
                }

                function back() {
                    if (justEvaluated) justEvaluated = false
                    expression = expression.slice(0, -1)
                    updateDisplay()
                }

                function evalExpression() {
                    if (!expression) return

                    try {
                        const value = Function('return ' + expression)()
                        const num = Number(value)

                        if (Number.isNaN(num)) {
                            resultEl.textContent = 'Error'
                        } else {
                            const res =
                                Math.round((num + Number.EPSILON) * 1e10) / 1e10
                            resultEl.textContent = res

                            history.unshift({ exp: expression, res })
                            if (history.length > 10) history.pop()
                            renderHistory()

                            expression = String(res)
                        }
                        justEvaluated = true
                    } catch {
                        resultEl.textContent = 'Error'
                        justEvaluated = true
                    }
                }

                function renderHistory() {
                    historyList.innerHTML = ''
                    if (!history.length) {
                        historyList.innerHTML = `<li class="history-empty">No calculations yet</li>`
                        return
                    }

                    history.forEach((h, i) => {
                        const li = document.createElement('li')
                        li.className = 'history-item'
                        li.dataset.index = i
                        li.innerHTML = `<span>${h.exp}</span><span>${h.res}</span>`
                        historyList.appendChild(li)
                    })
                }

                clearHistoryBtn.onclick = () => {
                    history.length = 0
                    renderHistory()
                }

                calc.addEventListener('click', (e) => {
                    const b = e.target.closest('button')
                    if (!b) return
                    const val = b.dataset.value
                    const act = b.dataset.action

                    if (val) appendValue(val)
                    else if (act === 'clear') clearAll()
                    else if (act === 'backspace') back()
                    else if (act === 'equals') evalExpression()
                })

                document.addEventListener('keydown', (e) => {
                    if (/[0-9.]/.test(e.key)) {
                        appendValue(e.key)
                        e.preventDefault()
                    } else if ('+-*/%'.includes(e.key)) {
                        appendValue(e.key)
                        e.preventDefault()
                    } else if (e.key === 'Enter') {
                        evalExpression()
                        e.preventDefault()
                    } else if (e.key === 'Backspace') {
                        back()
                        e.preventDefault()
                    } else if (e.key === 'Escape') {
                        clearAll()
                        e.preventDefault()
                    }
                })

                historyList.addEventListener('click', (e) => {
                    const li = e.target.closest('.history-item')
                    if (!li) return
                    const h = history[Number(li.dataset.index)]
                    expression = h.exp
                    resultEl.textContent = h.res
                    updateDisplay()
                })

                updateDisplay()
            })()
        </script>
    </body>
</html>
